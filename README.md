# Auth & Gateway 

## Техническое описание

Система аутентификации и авторизации построена на OpenResty (Nginx + Lua) с JWT токенами и прокси-архитектурой. Реализует единую точку входа для веб-приложений.

### Технологический стек

**Веб-сервер:** OpenResty (Nginx + LuaJIT)
**Аутентификация:** JWT токены с Lua обработкой
**Frontend:** JavaScript с асинхронными запросами
**Контейнеризация:** Docker Compose
**Прокси:** Обратное проксирование на FastAPI backend

### Архитектура системы

**Nginx Configuration**: Конфигурация маршрутизации с Lua модулями
**JWT Module**: Серверная валидация токенов через lua-resty-jwt
**Static Serving**: Разделение публичной и приватной статики
**Proxy Layer**: Прозрачное проксирование на backend сервисы
**Error Handling**: Централизованная обработка HTTP ошибок

### Логика аутентификации

**Публичные маршруты**: `/public/`, `/auth`, `/submit-form`, `/health`
**Защищенные маршруты**: `/forum`, `/api/`, `/private/`
**Автоматическое перенаправление**: Корневой маршрут `/` определяет статус JWT и перенаправляет на `/forum` или `/public/auth.html`

### Обработка запросов

Все защищенные маршруты проходят через `access_by_lua_block` с вызовом модуля `jwt-auth`. При валидном токене устанавливаются переменные `$jwt_valid` и `$jwt_user_login`, передаваемые в backend через заголовки `X-User-Login`.

## Функциональность

**Единый вход**: Общая форма для входа и регистрации
**JWT токены**: Аутентификация с автоматической валидацией
**Прокси-маршрутизация**: Прозрачное перенаправление на backend сервисы
**Статическая отдача**: Оптимизированная подача CSS/JS ресурсов
**Обработка ошибок**: JSON ответы для API endpoints

## Развертывание

Система контейнеризована через Docker Compose с монтированием статических файлов и логов.